---
phase: 08-entry-point-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/main.js
  - index.html
autonomous: true

must_haves:
  truths:
    - "Application initializes all three tab modules after DOM is ready"
    - "Tab switching works identically to pre-extraction behavior"
    - "index.html contains zero inline JavaScript logic"
    - "SheetJS CDN loads before any module code executes"
    - "Automated tests pass at 2/4 baseline (zero regressions)"
  artifacts:
    - path: "js/main.js"
      provides: "Application entry point with initialization and tab switching"
      contains: "initializeUI"
    - path: "index.html"
      provides: "HTML structure with single module script tag"
      contains: "js/main.js"
  key_links:
    - from: "index.html"
      to: "js/main.js"
      via: "script type=module src"
      pattern: "script type=module src=js/main.js"
    - from: "js/main.js"
      to: "js/ui/flat-bom.js"
      via: "ES6 import"
      pattern: "import.*initFlatBom.*from.*./ui/flat-bom.js"
    - from: "js/main.js"
      to: "js/ui/comparison.js"
      via: "ES6 import"
      pattern: "import.*initComparison.*from.*./ui/comparison.js"
    - from: "js/main.js"
      to: "js/ui/hierarchy.js"
      via: "ES6 import"
      pattern: "import.*initHierarchy.*from.*./ui/hierarchy.js"
---

<objective>
Extract the 41-line inline `<script type="module">` block from index.html into a dedicated js/main.js entry point file, completing the multi-file refactor.

Purpose: Eliminates the last inline JavaScript from index.html, establishing a clean entry point that wires all modules together. After this, index.html is pure HTML structure.

Output: js/main.js (entry point), updated index.html (zero inline JS)
</objective>

<execution_context>
@C:/Users/amcallister/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/amcallister/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-entry-point-consolidation/08-RESEARCH.md
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create js/main.js entry point from inline script</name>
  <files>js/main.js</files>
  <action>
Create js/main.js by extracting the inline script block from index.html (lines 393-433).

The file must contain:
1. Three imports with paths adjusted for main.js location (inside js/ directory):
   - `import { init as initFlatBom } from './ui/flat-bom.js';`
   - `import { init as initComparison } from './ui/comparison.js';`
   - `import { init as initHierarchy } from './ui/hierarchy.js';`
   Note: Paths change from `'./js/ui/...'` (relative to index.html) to `'./ui/...'` (relative to js/main.js).

2. DOMContentLoaded safety check (existing pattern, verbatim):
   ```javascript
   if (document.readyState === 'loading') {
       document.addEventListener('DOMContentLoaded', initializeUI);
   } else {
       initializeUI();
   }
   ```

3. initializeUI() function (private, not exported) containing:
   - Three init() calls: initFlatBom(), initComparison(), initHierarchy()
   - Tab switching logic (querySelectorAll for .tab-btn and .tab-content, click event listeners that toggle 'active' class)

Do NOT export initializeUI — it is a private entry-point function.
Do NOT add any new functionality — this is a byte-for-byte extraction with only import path adjustments.
  </action>
  <verify>
Verify js/main.js exists and contains:
- Three import statements with './ui/' paths
- DOMContentLoaded readyState check
- initializeUI function with three init calls and tab switching
- No exports (pure entry point)

Run: `cd test && node run-tests.js` — must pass 2/4 (baseline maintained)
  </verify>
  <done>js/main.js contains the complete application initialization logic extracted from the inline script, with import paths adjusted for its location in the js/ directory</done>
</task>

<task type="auto">
  <name>Task 2: Replace inline script in index.html with main.js reference</name>
  <files>index.html</files>
  <action>
In index.html, replace the entire inline script block (lines 393-433):
```html
    <script type="module">
        import { init as initFlatBom } from './js/ui/flat-bom.js';
        ...
    </script>
```

With a single external module script tag:
```html
    <script type="module" src="js/main.js"></script>
```

Place this tag in the same location (just before `</body>`).

Verify these elements remain unchanged:
- CDN script tag in `<head>`: `<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>`
- CSS link tag in `<head>`: `<link rel="stylesheet" href="css/styles.css">`
- All HTML structure between `<body>` opening and the script tag

After this change, index.html should contain ZERO inline JavaScript — only HTML structure, the CDN script reference, the CSS reference, and the module entry point reference.
  </action>
  <verify>
Verify index.html:
- Contains `<script type="module" src="js/main.js"></script>` before `</body>`
- Contains NO `<script type="module">` inline blocks (no script content between tags)
- CDN script tag still in `<head>`
- All HTML structure preserved (391 lines of HTML + 1 script tag line)

Run: `cd test && node run-tests.js` — must pass 2/4 (baseline maintained)
  </verify>
  <done>index.html contains only HTML structure and script/link references — zero inline JavaScript remains</done>
</task>

</tasks>

<verification>
1. Run automated tests: `cd test && node run-tests.js` — 2/4 pass (baseline)
2. Verify js/main.js exists with correct import paths (./ui/ not ./js/ui/)
3. Verify index.html has no inline script content
4. Verify CDN script tag still in `<head>` (SheetJS loads before modules)
5. Verify module script tag references js/main.js
6. Count lines in index.html — should be ~394 (391 HTML + ~3 for script tag area)
</verification>

<success_criteria>
- js/main.js exists and contains all initialization logic
- index.html has zero inline JavaScript
- Import paths in main.js use './ui/' (relative to js/ directory)
- CDN loading order preserved (SheetJS before modules)
- Automated tests pass 2/4 (zero regressions from baseline)
- DOMContentLoaded pattern preserved exactly
- Tab switching logic preserved exactly
</success_criteria>

<output>
After completion, create `.planning/phases/08-entry-point-consolidation/08-01-SUMMARY.md`
</output>
