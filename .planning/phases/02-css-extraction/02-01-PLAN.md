---
phase: 02-css-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [css/styles.css, index.html]
autonomous: false

must_haves:
  truths:
    - "All CSS from the main <style> block (lines 9-841) exists in css/styles.css"
    - "index.html links to css/styles.css via <link> tag instead of containing inline CSS"
    - "HTML export functions are untouched (their embedded <style> blocks remain inline)"
    - "Visual appearance is pixel-identical in browser across all three tabs"
    - "Print styles work identically (Ctrl+P shows same result)"
    - "Google Fonts load correctly (JetBrains Mono and Work Sans visible)"
  artifacts:
    - path: "css/styles.css"
      provides: "All application CSS extracted from index.html"
      min_lines: 800
      contains: "@import url.*fonts.googleapis.com"
    - path: "index.html"
      provides: "HTML structure with external stylesheet link"
      contains: '<link rel="stylesheet" href="css/styles.css">'
  key_links:
    - from: "index.html"
      to: "css/styles.css"
      via: "<link rel='stylesheet'> tag in <head>"
      pattern: 'link.*rel.*stylesheet.*href.*css/styles.css'
    - from: "css/styles.css"
      to: "Google Fonts CDN"
      via: "@import url at top of file"
      pattern: "@import url.*fonts.googleapis.com"
---

<objective>
Extract all CSS from the main `<style>` block in index.html (lines 9-841) into a new `css/styles.css` file, and replace the `<style>` block with a `<link>` tag pointing to the external stylesheet. The three `<style>` blocks inside JavaScript HTML export template literals (lines ~1908, ~3136, ~4076) must NOT be modified -- they are embedded styles for self-contained HTML exports.

Purpose: Separates styling from markup, reducing index.html size by ~833 lines and creating a standalone CSS file that is easier to navigate, edit, and maintain. This is the first structural extraction phase of the multi-file refactor.

Output: `css/styles.css` file containing all application CSS; updated `index.html` with `<link>` tag replacing inline `<style>` block.
</objective>

<execution_context>
@C:\Users\amcallister\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\amcallister\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-css-extraction/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract CSS to external stylesheet and update index.html</name>
  <files>css/styles.css, index.html</files>
  <action>
**Step 1: Create css/ directory**
Create the `css/` directory at the project root.

**Step 2: Extract CSS content into css/styles.css**
Read index.html lines 9-841 (the content BETWEEN the `<style>` and `</style>` tags on lines 8 and 842). Write this content verbatim into `css/styles.css`. The CSS file should:
- Start with the `@import url(...)` for Google Fonts (originally line 9)
- End with the `/* Hierarchy Table Styles */` comment (originally line 841)
- Contain EVERY line of CSS exactly as-is -- no reordering, no consolidation, no modifications
- NOT include the `<style>` or `</style>` HTML tags
- NOT include any leading whitespace indentation from the HTML context (the original CSS has 8-space indentation from being inside `<style>` -- remove this leading indentation so CSS is properly formatted at the file root level)

Add a single-line comment at the very top of the file before the @import: `/* BOM Tool 2.1 - Application Styles */`

**Step 3: Replace `<style>` block in index.html**
In index.html, replace lines 8-842 (the entire `<style>...</style>` block) with a single `<link>` tag:
```html
    <link rel="stylesheet" href="css/styles.css">
```
This goes in the same position in `<head>`, after the SheetJS `<script>` tag (line 7) and before `</head>`.

**CRITICAL: Do NOT modify the other three `<style>` blocks in the file.** These are inside JavaScript template literals (HTML export functions) at approximately:
- Line ~1908 (Flat BOM HTML export)
- Line ~3136 (Comparison HTML export)
- Line ~4076 (Hierarchy HTML export)

After the replacement, the `<head>` section should look like:
```html
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOM Tool 2.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
```

**Step 4: Verify line count**
After extraction, verify:
- css/styles.css has approximately 833 lines (lines 9-841 = 833 lines of CSS content, plus 1 comment header = ~834)
- index.html decreased by approximately 833 lines (replaced 835-line block with 1 `<link>` line)
- index.html still contains exactly 3 `<style>` tags (the export function ones)

**What NOT to do:**
- Do NOT consolidate @media print blocks -- keep them in their original positions
- Do NOT add section comments beyond the single header comment -- extract verbatim
- Do NOT change any CSS values, selectors, or properties
- Do NOT modify anything outside the main `<style>` block (lines 8-842)
- Do NOT touch HTML export functions or their embedded styles
  </action>
  <verify>
1. Run: `wc -l css/styles.css` -- should be approximately 834 lines
2. Run: `grep -c "<style>" index.html` -- should return exactly 3 (the export function styles only)
3. Run: `grep -c "</style>" index.html` -- should return exactly 3
4. Run: `grep '<link rel="stylesheet" href="css/styles.css">' index.html` -- should find exactly 1 match
5. Run: `head -3 css/styles.css` -- should show header comment followed by @import for Google Fonts
6. Run: `grep "@import url" css/styles.css` -- should find the Google Fonts import
7. Run: `grep ":root" css/styles.css` -- should find CSS custom properties
8. Run: `grep "@media print" css/styles.css` -- should find print media queries
9. Run: `cd test && node run-tests.js` -- all 4 automated tests must still pass (CSS extraction should not affect Node.js tests, but verify nothing broke)
  </verify>
  <done>
- css/styles.css exists with ~834 lines containing all extracted CSS
- index.html references css/styles.css via `<link>` tag
- index.html no longer has the main `<style>` block (only export function styles remain)
- All 4 automated tests still pass
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Extracted all application CSS from index.html into css/styles.css. The HTML file now links to the external stylesheet. Export function styles are untouched.</what-built>
  <how-to-verify>
Open index.html in your browser (double-click or open in Chrome/Edge). Do a hard refresh (Ctrl+Shift+R) to bypass any cache.

**1. Check DevTools Network tab:**
   - Open DevTools (F12) → Network tab → Refresh page
   - Verify css/styles.css loads successfully (200 status, not 404)
   - No console errors related to missing styles

**2. Verify Flat BOM tab:**
   - Upload test-data/258730-Rev2-20260105.XML
   - Confirm table renders with proper styling (blue headers, alternating rows)
   - Confirm fonts load: JetBrains Mono in data cells, Work Sans in UI text
   - Confirm upload zone has dashed border and hover effect

**3. Verify BOM Comparison tab:**
   - Click "BOM Comparison" tab
   - Upload old XML: test-data/258754-Rev0-20251220.XML
   - Upload new XML: test-data/258754-Rev1-20260112.XML
   - Run comparison
   - Confirm colored badges appear (green Added, red Removed, orange Changed)
   - Confirm filter buttons are styled correctly

**4. Verify Hierarchy View tab:**
   - Click "Hierarchy View" tab
   - Upload test-data/258730-Rev2-20260105.XML
   - Confirm tree lines render correctly (vertical and horizontal connectors)
   - Confirm expand/collapse toggle boxes are 14x14px bordered squares
   - Confirm expand/collapse all buttons work

**5. Quick print check:**
   - Press Ctrl+P to open print preview
   - Verify buttons and upload zones are hidden
   - Verify content displays on white background

**6. Verify an HTML export still works standalone:**
   - From Flat BOM tab (with file loaded), click "Export HTML"
   - Open the exported HTML file
   - Confirm it renders correctly with embedded styles (does NOT depend on css/styles.css)

If everything looks identical to before: type "approved"
If anything looks wrong: describe what you see
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. css/styles.css exists and contains ~834 lines of CSS
2. index.html uses `<link rel="stylesheet" href="css/styles.css">` in `<head>`
3. index.html has exactly 3 remaining `<style>` tags (all inside export functions)
4. All 4 automated tests pass (`cd test && node run-tests.js`)
5. Browser visual verification confirms pixel-identical appearance
6. Google Fonts load correctly
7. Print styles work
8. HTML exports remain self-contained
</verification>

<success_criteria>
- css/styles.css contains all application CSS extracted verbatim from index.html
- index.html links to external stylesheet instead of inline `<style>` block
- Visual appearance is pixel-identical in browser (all three tabs verified by user)
- Export functions unchanged (HTML exports still self-contained)
- All 4 automated tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-css-extraction/02-01-SUMMARY.md`
</output>
