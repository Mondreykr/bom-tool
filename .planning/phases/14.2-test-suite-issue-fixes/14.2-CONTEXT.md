# Phase 14.2: Test Suite Issue Fixes - Context

**Gathered:** 2026-02-15
**Status:** Ready for planning

<domain>
## Phase Boundary

Fix UI/UX bugs discovered during test suite 1 validation (test-suite-1-20260215.md). Covers broken toggle buttons, incorrect source labels, job number prepopulation logic, error/warning formatting, upload panel layout, IFP revision auto-increment, and investigation of the 258758 XML false positive. No new capabilities — only fixes to existing Phase 14 features.

</domain>

<decisions>
## Implementation Decisions

### Source Labels & Resolved References
- Source column in merged tree uses resolved labels: **X(2)**, **B(1)**, **New (WIP)**
- X(n) resolves to actual source export revision number (e.g., X(2))
- B(n-1) resolves to actual prior artifact revision number (e.g., B(1))
- Placeholder nodes labeled **New (WIP)** (not "No Prior" or "Placeholder")
- **All user-facing text** resolves to actual numbers — warnings, merge summary, source column, everywhere
- No more abstract B(n-1) or X(n) notation in any user-facing text

### Job Number Logic
- If GA PN starts with '1': default job number to just "1J" (user must type 6 more digits)
- If GA PN does NOT start with '1': prepopulate full 1J{PN} (e.g., GA 258730 → 1J258730)
- Job number must match pattern 1Jxxxxxx (1J + exactly 6 digits) — **Export disabled** until valid
- Field is always editable — prepopulation is a suggestion, user can change to any valid value
- Regular text field pre-filled with appropriate value (no locked prefix UX)

### Error & Warning Format
- Breadcrumb path format already fixed in Quick Task 2 — no changes needed there
- Validation errors include raw PDM state in square brackets: `... is WIP [Checked Out]`
- Warning messages include description in parentheses: `1035708 (A4 Assembly) was in B(2) but not found in X(3)`
- Errors color-coded red, warnings color-coded yellow/amber — visual distinction in validation area

### Upload Panel Layout
- Swap sides: **Prior IFP B(n-1) on LEFT**, **Source Export X(n) on RIGHT** (old-to-new, left-to-right)
- REV0 toggle stays at top of upload area, above both panels
- JSON tree preview on load — when B(n-1) is uploaded, show tree immediately (same as XML does)
- Side-by-side tree previews — each upload panel shows its own tree independently before merge
- JSON tree preview includes state pills (Released/WIP) — consistent visual language with XML tree

### IFP Revision Auto-Increment
- When B(n-1) JSON is loaded, auto-increment IFP revision to B(n-1) + 1
- Currently stuck at REV0 even when prior artifact loaded — must fix

### Toggle Button Fixes
- "Hide WIP Content" toggle not working — needs investigation and fix
- "Hide B(N-1) Substitutions" toggle not working — needs investigation and fix

### 258758 XML Investigation
- File 258758-Rev3-20260205.XML reports false positive errors
- "Missing NS Item Type" error when NS Item Type is actually present
- Root cause likely: parent nodes with empty Part Number, Revision, Description fields
- Need to investigate XML structure and fix error reporting logic

### Claude's Discretion
- Exact implementation approach for toggle button fixes
- Technical investigation of 258758 XML false positive
- How to render side-by-side tree previews within current layout
- Loading skeleton/spinner while trees render

</decisions>

<specifics>
## Specific Ideas

- "Can I see the BOM from the JSON when I first load it just like the XML does the moment I drop it in? Then I can see it before I drop in the new XML"
- Source labels should resolve everywhere — user wants to see B(1) not B(n-1), because the specific reference matters for traceability
- Warning for missing assemblies should include description since you can't see the node in the merged BOM anymore (it's gone)

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 14.2-test-suite-issue-fixes*
*Context gathered: 2026-02-15*
