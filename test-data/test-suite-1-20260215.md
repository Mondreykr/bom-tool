# Test Suite 1 20260215 - with results

```
BOM Structure (create once)

  GA1 (Assembly)
  ├── A1 (Assembly)
  │   ├── C1 (component)
  │   └── C2 (component)
  ├── A2 (Assembly)
  │   ├── A3 (Assembly Weldment)      ← nesting for depth
  │   │   └── C3 (component) + multiple components for weldment
  │   └── C4 (component)
  └── C5 (component under GA)
  
Later add:
 - A4 (Assembly) under GA1 with C6 — for "new assembly not in prior"
```

## Test Files
- Located in /test-data
- GA is 1035704 
- Job Number is 1J250000
- B(n) outputs are "1J250000-IFP REV#..."
- X(n) files are 1035704-Rev#..."



### 1. X(0) — "First IFP, some WIP"

State: GA1 Released, A1 Released, A2 Released, A3 WIP, all components Released

Tests:

- REV0 happy path (merge succeeds)
- A3 becomes empty placeholder (WIP assembly, no prior artifact)
- Placeholder warning generated

**Produces: B(0)**

- Test Notes
    
    1035704-Rev0-20260214.XML
    
    - job number should be prepopulated, not just suggested, means they don't have to type it and accidentally get it wrong. However, if the part number of the GA starts with a 1 (what's driving the default job number i think), it should NOT be prepopulated. It should only in that case be 1J and require another 6 digits to follow. For example, if the GA PN is 1035704, then the default Job Number should be "1J" and that's it. And the Export should not work until it's 1Jxxxxxx (where x is a digit). And if the GA PN is 258730, then that's fine, and the Job Number should default to 1J258730.
    - the “Hide WIP Conent” button doesn’t seem to do anything either before or after I hit the merge button. I had uploaded the XML and there was 1035707 which was WIP and had WIP children. Then after merge it was just 1035707 which seems correct. But Hide WIP didn’t do anything.
- [x]  Finished Tes

### 2. X(1) — "A1 under revision"

State: A1 goes WIP. A3 now Released. Everything else Released.

Tests:

- Standard L1 graft (A1 subtree grafted from B(0))
- A3 now Released — passes through normally

**Produces: B(1)**

- Test Notes
    
    1035704-Rev0-20260214.XML
    
    - can I see the BOM from the json when I first load it just like the XML does the moment I drop it in? then I can see it before I drop in the new XML
    - IFP revision thought it was still REV0 even though I had uploaded a json at IFP REV0 and an XML (at REV1 though it shouldn't matter). I think it should auto increment 1 up from the JSON loaded.
    - Is the source column supposed to be empty always? What goes in the source column and when? I think it should always be filled for each line, that way you can see. 
    Change the Source column in the merged tree view to show three distinct labels instead of blank/"B(n-1)":
        - Current — Passed-through nodes (released assemblies from X(n))
            - Or it could say X(n) where n is resolved, e.g., X(2)
        - Prior B(n-1) — Grafted nodes (WIP assemblies swapped with B(n-1) version) and “n-1” should be the actual value of the contributing json integer, e.g., B(1)
            - Or this could be simply B(n-1) where it resolves, e.g., B(1) … which equates to IFP REV1
        - No Prior — Placeholder nodes (WIP assemblies with no prior release)
- [x]  Finished Test

### 3. X(2) — "Deep WIP + qty change"

State: A1 back to Released (change A1's qty from what it was in X(1)). A3 goes WIP again.

Tests:

- Deep graft (A3 at L2 grafted from B(1))
- Change annotation on A1 (qty differs from B(1))

**Produces: B(2)**

- Test notes
    - `Hide B(N-1) Substitutions` button didn’t do anything
- [x]  Finished Test

### 4. X(3) — "New assembly + removal"

State: Add A4+C6 under GA1, A4 is WIP. Remove A1 from BOM.

Tests:

- A4 placeholder (WIP, not in B(2))
- Missing assembly warning (A1 was in B(2) but gone from X(3))
- Multiple grafts if A3 still WIP

**Produces: B(3)**

- Test Notes
    - warnings should show description in parentheses for easier ID - 1035708 (A4) was removed and the warning showed up that it exists in B(n-1) but you can’t see it in the merged BOM since it’s gone, so you can’t see the Description.
    - the “n-1” should resolve everywhere it’s used so that the referent is specific, whether warnings or elsewhere
- [x]  Finished Test

### 5. X(4) — "Validation: WIP component" (Rule 1)

State: C5 set to WIP state. Everything else Released.

Tests:

- Rule 1 violation — WIP non-assembly under Released GA
- Merge blocked with error message

**Produces: Nothing — blocked**

- Test Notes
    - naming the state of the file in the error would be helpful, e.g., "... WIP ([FileState]) ...
    - errors should always start with the file path before " : [description]" rather than [description] before file path. E.g., I don't want "Missing NS Item Type on at 258758 > 1035158 > 1035167 > — cannot validate without knowing node type". I'd rather have the "Missing NS..." put together with the rest of the description after the file path.
    - the source export and prior IFP artifact should flip sides. Prior is always the previous, source XML is the new, old to new left to right.
- [x]  Finished Test

### 6. X(5) — "Validation: all-WIP children" (Rule 2)

State: A1 and A2 and A4 to WIP. Remove C5 from GA1 BOM (so GA has only assembly children, all WIP).

Tests:

- Rule 2 violation — Released GA with only WIP assembly children
- Merge blocked with error message

**Produces: Nothing — blocked**

- Test Notes
    - none, success
- [x]  Finished Test

### 7. X(6) — "Clean after rework"

State: Everything Released again (A4 now Released too)

Tests:

- Full clean merge after complex history

**Produces: B(4)**

- Test Notes
    - None, Success.
- [x]  Finished Test

### Scenario Coverage

| Validation Rule / Scenario | Covered by |
| --- | --- |
| Rule 0: WIP GA | N/A – PDM enforces |
| Rule 1: WIP component under Released parent | X(4) |
| Rule 2: Released assembly, all WIP children | X(5) |
| Missing NS Item Type | See question below |
| REV0 with placeholder | X(0) |
| L1 graft | X(1) |
| Deep (L2) graft | X(2) |
| Multiple simultaneous grafts | X(3) |
| New assembly, no prior | X(3) |
| Missing assembly warning | X(3) |
| Qty change annotation | X(2) |
| Clean merge after history | X(6) |


## General Test Notes
- warnings and rule violations should have warning messages - so a suite of warning messages that match the rules is important. And it means all the rules in the validation-logic.md should be accurate with the code.
- the test file `258758-Rev3-20260205.XML` gave an error "Missing NS Item Type on at 258758 > 1035158 > 1035167 > — cannot validate without knowing node type" But the XML seems fine at that point. Why is it being flagged? The same file also gave the error "258758 > 1035158 > 1035167 > : Released assembly has no released content — all sub-assemblies are WIP". I looked at the XML and sure enough the parent was missing its Part Number and some other fields. It's the parent of these items with pdmweid = 
132439
132441
132522
132522
so I guess it found blank assembly items which is good. It recognized the structure and still produced the structure, but it's pointing out the wrong errors. You can investigate the XML to see for yourself. The NS Item Type is actually there. But the Part Number and Revision and Description are empty, as well as the XML's `id=` field. So I think it was probably true that all the assembly items were WIP because they did not have a proper state since they were empty. 


